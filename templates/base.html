{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sunren International Inc.{% endblock %}</title>
    <meta name="description" content="{% block meta_description %}Sunren International Inc. - Leading supplier of high-quality chemicals and specialty compounds for pharmaceutical, manufacturing, and agricultural industries.{% endblock %}">

    <!-- Open Graph Meta Tags -->
    <meta property="og:type" content="{% block og_type %}website{% endblock %}">
    <meta property="og:title" content="{% block og_title %}Sunren International Inc.{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Sunren International Inc. - Leading supplier of high-quality chemicals and specialty compounds for pharmaceutical, manufacturing, and agricultural industries.{% endblock %}">
    <meta property="og:url" content="{% block og_url %}{{ request.build_absolute_uri }}{% endblock %}">
    <meta property="og:site_name" content="Sunren International Inc.">
    <meta property="og:image" content="{% block og_image %}{% static 'images/og-default.png' %}{% endblock %}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:locale" content="en_US">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}Sunren International Inc.{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}Sunren International Inc. - Leading supplier of high-quality chemicals and specialty compounds for pharmaceutical, manufacturing, and agricultural industries.{% endblock %}">
    <meta name="twitter:image" content="{% block twitter_image %}{% static 'images/og-default.png' %}{% endblock %}">

    <!-- Link to Tailwind CSS -->
    <link href="{% static 'css/output.css' %}" rel="stylesheet">
    
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'favicon/site.webmanifest' %}">
</head>

<nav class="bg-gray-100 sticky top-0 z-50 shadow-md border-b border-gray-300">
    <div class="max-w-6xl mx-auto flex flex-wrap items-center justify-between px-4 py-2 gap-2">
        <!-- Clickable Title as Home Link -->
        <a href="{% url 'home' %}" class="flex items-center gap-2 text-xl font-bold text-[#183354] hover:text-blue-600 transition relative group">
            <!-- Home Icon -->
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" />
              </svg>
              
              
            
            Sunren International Inc.
            <!-- Visual Indicator (Underline) -->
            <span class="absolute left-0 bottom-0 w-0 h-0.5 bg-blue-600 transition-all duration-300 group-hover:w-full"></span>
        </a>        

        <!-- Search Bar with Autocomplete -->
        <div class="relative w-full sm:w-auto max-w-lg" id="search-container">
            <form method="get" action="{% url 'search_results' %}" 
                  class="flex items-center border border-gray-400 rounded-md px-4 py-2 focus-within:border-blue-500 transition bg-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-600 mr-2 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-4.35-4.35M16 10.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0Z" />
                </svg>
                <input 
                    type="text" 
                    name="q" 
                    id="search-input"
                    placeholder="Search by Name / CAS / Uses" 
                    value="{% if query %}{{ query }}{% endif %}" 
                    class="w-full min-w-[250px] sm:min-w-[300px] outline-none text-gray-700"
                    autocomplete="off"
                >
                <button type="submit" class="hidden">Search</button>
            </form>
            <!-- Autocomplete Dropdown -->
            <div id="autocomplete-dropdown" 
                 class="absolute top-full left-0 right-0 bg-white border border-gray-300 rounded-md shadow-lg mt-1 z-50 hidden max-h-80 overflow-y-auto">
            </div>
        </div>
    </div>
</nav>

    <!-- Content from child templates will be injected here -->
    {% block content %}
    {% endblock %}

    <section class="bg-gray-100 py-4 px-4">
        <h2 class="text-2xl font-bold text-center text-blue-700">Contact Us</h2>
        <form action="{% url 'contact_form' %}" method="POST" class="max-w-md ml-0 sm:mx-auto mt-3 pb-4">
            {% csrf_token %}
            <input type="text" name="name" placeholder="Name" class="w-full p-1.5 border rounded-md mb-1.5" required>
            <input type="tel" name="phone" placeholder="Phone Number" class="w-full p-1.5 border rounded-md mb-1.5" required>
            <input type="email" name="email" placeholder="E-mail" class="w-full p-1.5 border rounded-md mb-1.5" required>
            <button type="submit" class="btn-secondary">Submit Now</button>
        </form>
        <div class="flex flex-col sm:flex-row justify-start sm:justify-center gap-4 sm:gap-6 mb-4">
            <a href="tel:+16263051545" class="flex items-center gap-2 text-blue-700 hover:text-blue-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
                +1 (626)-305-1545
            </a>
            <a href="mailto:customerservice@sunrenintl.com" class="flex items-center gap-2 text-blue-700 hover:text-blue-500">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
                customerservice@sunrenintl.com
            </a>
        </div>
    </section>

    <footer class="bg-[#183354] text-white py-4">
        <div class="max-w-6xl mx-auto px-4 text-center space-y-4">
            <p class="text-sm font-semibold tracking-wide">Sunren International Inc. All rights reserved.</p>
            <p class="text-xs leading-6 text-gray-300">
                Disclaimer: Sunren International Inc. makes every effort to ensure that the information displayed on this website is accurate and complete. However, it is not liable for any errors, inaccuracies, or omissions. The majority of the information on sunrenintl.com is subject to change without prior notice or intimation.
            </p>
        </div>
    </footer>

    <!-- Autocomplete JavaScript -->
    <script>
    (function() {
        const searchInput = document.getElementById('search-input');
        const dropdown = document.getElementById('autocomplete-dropdown');
        const searchContainer = document.getElementById('search-container');
        let debounceTimer;
        let selectedIndex = -1;
        let suggestions = [];

        if (!searchInput || !dropdown) return;

        // Debounced fetch for autocomplete
        searchInput.addEventListener('input', function() {
            const query = this.value.trim();
            clearTimeout(debounceTimer);
            
            if (query.length < 2) {
                hideDropdown();
                return;
            }

            debounceTimer = setTimeout(() => {
                fetchSuggestions(query);
            }, 150);
        });

        // Keyboard navigation
        searchInput.addEventListener('keydown', function(e) {
            if (!dropdown.classList.contains('hidden')) {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    selectedIndex = Math.min(selectedIndex + 1, suggestions.length - 1);
                    updateSelection();
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    selectedIndex = Math.max(selectedIndex - 1, -1);
                    updateSelection();
                } else if (e.key === 'Enter' && selectedIndex >= 0) {
                    e.preventDefault();
                    navigateToSuggestion(suggestions[selectedIndex]);
                } else if (e.key === 'Escape') {
                    hideDropdown();
                }
            }
        });

        // Hide dropdown when clicking outside
        document.addEventListener('click', function(e) {
            if (!searchContainer.contains(e.target)) {
                hideDropdown();
            }
        });

        // Show dropdown when focusing on input with existing value
        searchInput.addEventListener('focus', function() {
            if (this.value.trim().length >= 2 && suggestions.length > 0) {
                showDropdown();
            }
        });

        async function fetchSuggestions(query) {
            try {
                const response = await fetch(`/api/autocomplete/?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                suggestions = data.suggestions || [];
                selectedIndex = -1;
                renderSuggestions();
            } catch (error) {
                console.error('Autocomplete error:', error);
                hideDropdown();
            }
        }

        function renderSuggestions() {
            if (suggestions.length === 0) {
                hideDropdown();
                return;
            }

            dropdown.innerHTML = suggestions.map((item, index) => `
                <a href="/chemical/${item.slug}/" 
                   class="autocomplete-item block px-4 py-3 hover:bg-blue-50 cursor-pointer border-b border-gray-100 last:border-b-0 ${index === selectedIndex ? 'bg-blue-50' : ''}"
                   data-index="${index}">
                    <div class="font-medium text-gray-800">${highlightMatch(item.name, searchInput.value)}</div>
                    <div class="text-sm text-gray-500 flex gap-3 mt-0.5">
                        ${item.cas_number ? `<span>CAS: ${item.cas_number}</span>` : ''}
                        ${item.group ? `<span class="text-blue-600">${item.group}</span>` : ''}
                    </div>
                </a>
            `).join('');

            // Add click handlers
            dropdown.querySelectorAll('.autocomplete-item').forEach(item => {
                item.addEventListener('mouseenter', function() {
                    selectedIndex = parseInt(this.dataset.index);
                    updateSelection();
                });
            });

            showDropdown();
        }

        function highlightMatch(text, query) {
            if (!query) return text;
            const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return text.replace(regex, '<mark class="bg-yellow-200 rounded px-0.5">$1</mark>');
        }

        function updateSelection() {
            dropdown.querySelectorAll('.autocomplete-item').forEach((item, index) => {
                if (index === selectedIndex) {
                    item.classList.add('bg-blue-50');
                } else {
                    item.classList.remove('bg-blue-50');
                }
            });
        }

        function navigateToSuggestion(item) {
            window.location.href = `/chemical/${item.slug}/`;
        }

        function showDropdown() {
            dropdown.classList.remove('hidden');
        }

        function hideDropdown() {
            dropdown.classList.add('hidden');
            selectedIndex = -1;
        }
    })();
    </script>
    </body>
</html>

